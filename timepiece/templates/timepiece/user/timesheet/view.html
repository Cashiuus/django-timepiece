{% extends "timepiece/base.html" %}
{% load url from future %}
{% load timepiece_tags %}

{% block title %}
    {{ timesheet_user.get_name_or_username }} - Timesheet
{% endblock title %}

{% block breadcrumb %}{% endblock breadcrumb %}

{% block extracss %}
<link rel="stylesheet"
        href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css">
<link rel="stylesheet"
        href="{{ STATIC_URL }}timepiece/less/timesheet.css">
{% endblock extracss %}

{% block extrajs %}
{# So that we can make CSRF-friendly AJAX requests. #}
<script src="{{ STATIC_URL }}timepiece/js/ajax.js"></script>

{# Underscore templates. #}
<script type="text/template" id="week-template">
    {% include "timepiece/user/timesheet/inc/week.html" %}
</script>
<script type="text/template" id="entry-row-template">
    {% include "timepiece/user/timesheet/inc/entry_row.html" %}
</script>
<script type="text/template" id="project-summary-template">
    {% include "timepiece/user/timesheet/inc/project_summary.html" %}
</script>
<script type="text/template" id="weekly-summary-template">
    {% include "timepiece/user/timesheet/inc/weekly_summary.html" %}
</script>
<script type="text/template" id="paid-leave-summary-template">
    {% include "timepiece/user/timesheet/inc/paid_leave_summary.html" %}
</script>

{# Backbone & related scripts to power the timesheet. #}
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
<script src="{{ STATIC_URL }}timepiece/js/timesheet/utils.js"></script>
<script src="{{ STATIC_URL }}timepiece/js/timesheet/models.js"></script>
<script src="{{ STATIC_URL }}timepiece/js/timesheet/views.js"></script>
<script>
var verify_url = "{% url 'verify_entries' %}",
    approve_url = "{% url 'approve_entries' %}",
    reject_url = "{% url 'reject_entries' %}",
    timesheet;
$(function() {
    $.ajax({
        url: "{% user_timesheet_url timesheet_user.pk this_month ajax=True %}",
        dataType: 'json'
    }).done(function(data, status, xhr) {
        timesheet = new Timesheet({
            'collection': new EntryCollection(data['entries']),
            'weekRanges': data['weeks'],
            'thisMonth': new Date(data['this_month']),
            'nextMonth': new Date(data['next_month']),
            'lastMonth': new Date(data['last_month'])
        });
    }).fail(function(xhr, status, error) {
        alert('There was an error loading the data.');  // TODO
    });
})
</script>
{% endblock extrajs %}

{% block content %}
<div class="page-header">
    <h1>
        {{ timesheet_user.get_name_or_username }} -
        <span class="this-month">{{ this_month|date:"F Y" }}</span>
    </h1>
</div>

<div class="tabbable">
    <div class="top-actions clearfix">
        <div class="btn-toolbar pull-left">
            <div class="btn-group">
                <button class="btn" data-toggle="tooltip" title="Add Entry">
                    <i class="icon icon-plus"></i>
                    Add Entry
                </button>
            </div>
            <div class="btn-group">
                <button class="btn verify" data-toggle="tooltip" title="Verify All">
                    <i class="icon-white icon-ok"></i>
                    Verify All
                </button>
            </div>
            <div class="btn-group">
                <button class="btn approve" data-toggle="tooltip" title="Approve All">
                   <i class="icon-white icon-thumbs-up"></i>
                    Approve All
                </button>
                <button class="btn reject" data-toggle="tooltip" title="Reject All">
                    <i class="icon icon-thumbs-down"></i>
                    Reject All
                </button>
            </div>
        </div>
        <div class="btn-toolbar pull-right">
            <div class="btn-group">
                <a class="btn refresh" href=""><i class="icon icon-refresh"></i></a>
            </div>
            <div class="btn-group">
                <a class="btn last-month" href="{% user_timesheet_url timesheet_user.pk last_month %}">
                    <i class="icon icon-arrow-left"></i>
                    {{ last_month|date:"F" }}
                </a>
                <a class="btn next-month" href="{% user_timesheet_url timesheet_user.pk next_month %}">
                    {{ next_month|date:"F" }}
                    <i class="icon icon-arrow-right"></i>
                </a>
            </div>
            <div class="btn-group">
                <a class="btn" href="#select-month" role="button" data-toggle="modal">
                    <i class="icon icon-calendar"></i>
                    Other month...
                </a>
            </div>
            <div id="select-month" class="modal hide fade">
                <div class="modal-header">
                    <button type="button" class="close"
                            data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h3>Select month</h3>
                </div>
                <div class="modal-body">
                     <form method="get" class="form-inline"
                           action="{{ timesheet_user.get_timesheet_url }}">
                        {{ month_form.month }}
                        {{ month_form.year }}
                        <button type="submit" class="btn">Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs">
        <li{% if active_tab == "overview" %} class="active"{% endif %}>
            <a href="#overview" data-toggle="tab">Overview</a>
        </li>
        <li{% if active_tab == "all-entries" %} class="active"{% endif %}>
            <a href="#all-entries" data-toggle="tab">All Entries</a>
        </li>
    </ul>
    <div class="tab-content">
        <div id="overview"
                class="tab-pane{% if active_tab == 'overview' %} active{% endif %}">
        </div>

        <div id="all-entries"
                class="tab-pane{% if active_tab == 'all-entries' %} active{% endif %}">
        </div>
    </div>
</div>
{% endblock content %}
